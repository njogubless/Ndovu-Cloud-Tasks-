dist: bionic
addons:
  apt:
    sources:
      - deadsnakes
    packages:
      - python3.7
before_install:
  - sudo apt-get update
  - sudo apt purge python2.7-minimal
  - sudo apt-get install python3 python3-pip python3-setuptools
  - pip3 install --upgrade pip

script: 
  - python manage.py test

language: python

python:
  - "3.7"

services:
  - docker
env:
  global:
  - DOCKER_IMAGE_NAME=njogubless1/my-python-app 

before_script:
  - docker build -t njogubless1/my-python-app 
  - docker run -d --name my-container njogubless1/my-python-app 


script:
  - pytest

deploy:
  provider: script
  script: bash scripts/deploy.sh
  on:
    branch: main
